<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>List Consignments - Circuit Auction API</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
  <style>
      body { padding-top: 70px; background-color: #f8f9fa; }
      .navbar-brand { font-weight: bold; }
      .main-content { padding: 2rem; }
      pre { background: #f4f4f4; padding: 1rem; border-radius: 0.375rem; position: relative; }
      .copy-btn { position: absolute; top: 0.5rem; right: 0.5rem; font-size: 0.8rem; }
      .endpoint { font-family: 'Courier New', monospace; background: #e9ecef; padding: 0.2rem 0.4rem; border-radius: 0.25rem; }
      .badge-method { font-size: 0.7em; padding: 0.3em 0.6em; }
      .param-table th { background-color: #f8f9fa; }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="../index.html">Circuit Auction API</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="../consignments/list.html">Consignments</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container main-content">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="../index.html">API</a></li>
      <li class="breadcrumb-item"><a href="../consignments/list.html">Consignments</a></li>
      <li class="breadcrumb-item active">List Consignments</li>
    </ol>
  </nav>

  <h1>List Consignments (DataTable)</h1>
  <p class="lead">Retrieve a paginated list of consignments with advanced filtering, sorting, and field selection. Manage consignor inventory, commissions, shipping methods, and workflow tracking.</p>

  <div class="card mb-4">
    <div class="card-header">
      <span class="badge bg-success badge-method">GET</span>
      <code class="endpoint">/datatable-consignments</code>
    </div>
    <div class="card-body">
      <h5>Query Parameters</h5>
      <div class="table-responsive">
        <table class="table table-sm param-table">
          <thead>
          <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Description</th>
            <th>Example</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td><code>range</code></td>
            <td>integer</td>
            <td>Items per page (default: 25)</td>
            <td><code>?range=50</code></td>
          </tr>
          <tr>
            <td><code>page</code></td>
            <td>integer</td>
            <td>Page number (0-indexed)</td>
            <td><code>?page=2</code></td>
          </tr>
          <tr>
            <td><code>sort</code></td>
            <td>string</td>
            <td>Sort field and direction (prefix with - for descending)</td>
            <td><code>?sort=-updated</code></td>
          </tr>
          <tr>
            <td><code>sale_id</code></td>
            <td>integer</td>
            <td>Filter by sale ID (sale context)</td>
            <td><code>?sale_id=123</code></td>
          </tr>
          <tr>
            <td><code>filter[status]</code></td>
            <td>string</td>
            <td>Filter by consignment status</td>
            <td><code>?filter[status]=active</code></td>
          </tr>
          <tr>
            <td><code>filter[owner]</code></td>
            <td>integer</td>
            <td>Filter by owner (client) ID</td>
            <td><code>?filter[owner]=456</code></td>
          </tr>
          <tr>
            <td><code>filter[owner_name]</code></td>
            <td>string</td>
            <td>Filter by owner name (text search)</td>
            <td><code>?filter[owner_name]=Smith</code></td>
          </tr>
          <tr>
            <td><code>filter[responsible_user]</code></td>
            <td>string</td>
            <td>Filter by responsible user's full name</td>
            <td><code>?filter[responsible_user]=John</code></td>
          </tr>
          <tr>
            <td><code>filter[finder_fees]</code></td>
            <td>string</td>
            <td>Filter by finder name</td>
            <td><code>?filter[finder_fees]=finder_name</code></td>
          </tr>
          <tr>
            <td><code>filter[has_email]</code></td>
            <td>boolean</td>
            <td>Filter consignors with/without email</td>
            <td><code>?filter[has_email]=1</code></td>
          </tr>
          <tr>
            <td><code>workflow_filter</code></td>
            <td>integer</td>
            <td>Filter by workflow task completion</td>
            <td><code>?workflow_filter=5</code></td>
          </tr>
          <tr>
            <td><code>global_search</code></td>
            <td>string</td>
            <td>Search across multiple fields</td>
            <td><code>?global_search=antique</code></td>
          </tr>
          </tbody>
        </table>
      </div>

      <h5 class="mt-4">Response Fields</h5>
      <div class="table-responsive">
        <table class="table table-sm param-table">
          <thead>
          <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td><code>id</code></td>
            <td>string</td>
            <td>Consignment node ID</td>
          </tr>
          <tr>
            <td><code>consignment_id</code></td>
            <td>string</td>
            <td>Unique consignment identifier</td>
          </tr>
          <tr>
            <td><code>label</code></td>
            <td>string</td>
            <td>Consignment title/label</td>
          </tr>
          <tr>
            <td><code>published</code></td>
            <td>boolean</td>
            <td>Publication status</td>
          </tr>
          <tr>
            <td><code>promoted</code></td>
            <td>boolean</td>
            <td>Promoted to front page</td>
          </tr>
          <tr>
            <td><code>status</code></td>
            <td>object</td>
            <td>Consignment status with value and label</td>
          </tr>
          <tr>
            <td><code>owner</code></td>
            <td>object</td>
            <td>Consignor client information (references datatable-clients)</td>
          </tr>
          <tr>
            <td><code>customer_number</code></td>
            <td>string</td>
            <td>Customer number / PhilaWorksPlace ID</td>
          </tr>
          <tr>
            <td><code>sale</code></td>
            <td>object</td>
            <td>Associated sale information</td>
          </tr>
          <tr>
            <td><code>estimated</code></td>
            <td>integer</td>
            <td>Estimated value (cents)</td>
          </tr>
          <tr>
            <td><code>insurance_value</code></td>
            <td>integer</td>
            <td>Insurance value (cents)</td>
          </tr>
          <tr>
            <td><code>insurance_type</code></td>
            <td>string</td>
            <td>Type of insurance coverage</td>
          </tr>
          <tr>
            <td><code>underbid</code></td>
            <td>float</td>
            <td>Underbid amount</td>
          </tr>
          <tr>
            <td><code>house_consignment</code></td>
            <td>boolean</td>
            <td>Whether this is a house consignment</td>
          </tr>
          <tr>
            <td><code>no_post_sale</code></td>
            <td>boolean</td>
            <td>Exclude from post-sale processing</td>
          </tr>
          <tr>
            <td><code>consignor_commission_step_type</code></td>
            <td>string</td>
            <td>Commission calculation type</td>
          </tr>
          <tr>
            <td><code>consignor_commission_steps</code></td>
            <td>array</td>
            <td>Commission tiers with step_from and consignor_commission</td>
          </tr>
          <tr>
            <td><code>shipping_methods</code></td>
            <td>array</td>
            <td>Array of shipping method objects (see below)</td>
          </tr>
          <tr>
            <td><code>additional_charges</code></td>
            <td>array</td>
            <td>Additional fees and charges</td>
          </tr>
          <tr>
            <td><code>finder_fees</code></td>
            <td>array</td>
            <td>Finder fees with commission, finder, and item references</td>
          </tr>
          <tr>
            <td><code>tax_type</code></td>
            <td>string</td>
            <td>Tax calculation type</td>
          </tr>
          <tr>
            <td><code>tax_customs_number</code></td>
            <td>integer</td>
            <td>Highest tax customs number from shipping methods</td>
          </tr>
          <tr>
            <td><code>current_custom_shipping_id</code></td>
            <td>integer</td>
            <td>Current global custom shipping ID</td>
          </tr>
          <tr>
            <td><code>payment_instructions</code></td>
            <td>string</td>
            <td>Payment instructions for consignor</td>
          </tr>
          <tr>
            <td><code>files</code></td>
            <td>array</td>
            <td>Attached files (bills, documents)</td>
          </tr>
          <tr>
            <td><code>responsible_user</code></td>
            <td>array</td>
            <td>Responsible users with id and label (full name)</td>
          </tr>
          <tr>
            <td><code>workflow</code></td>
            <td>object</td>
            <td>Workflow inventory status</td>
          </tr>
          <tr>
            <td><code>statements</code></td>
            <td>array</td>
            <td>Associated consignment statements</td>
          </tr>
          <tr>
            <td><code>closed_statements</code></td>
            <td>array</td>
            <td>Closed statements for this consignment</td>
          </tr>
          </tbody>
        </table>
      </div>

      <h5 class="mt-4">Shipping Methods Structure</h5>
      <pre><code class="language-json">{
  "shipping_id": 123,
  "amount": 45.50,
  "tax_customs_number": 456,
  "tax_customs_type": "import",
  "date": "2025-10-15",
  "type": "outgoing",
  "method_type": { "id": 1, "label": "FedEx" },
  "customs_tracking_number": "TRACK123456",
  "shipping_notes": "Handle with care",
  "description": "Shipment details"
}</code></pre>

      <h5 class="mt-4">Additional Charges Structure</h5>
      <pre><code class="language-json">{
  "amount": 25.00,
  "term": { "id": 5, "label": "Photography" },
  "description": "Professional photography fee",
  "attached_to": "consignment",
  "tax": 5.00
}</code></pre>

      <h5 class="mt-4">Example Requests</h5>
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#basic">Basic</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#filter">Filter by Sale</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#owner">Filter by Owner</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#workflow">Workflow Filter</a></li>
      </ul>
      <div class="tab-content mt-2">
        <div class="tab-pane fade show active" id="basic">
          <pre><code class="language-bash">GET /api/v1.0/datatable-consignments?range=25&amp;sort=-updated</code></pre>
        </div>
        <div class="tab-pane fade" id="filter">
          <pre><code class="language-bash">GET /api/v1.0/datatable-consignments?sale_id=123&amp;range=25&amp;sort=consignment_id</code></pre>
        </div>
        <div class="tab-pane fade" id="owner">
          <pre><code class="language-bash">GET /api/v1.0/datatable-consignments?filter[owner]=456&amp;filter[status]=active</code></pre>
        </div>
        <div class="tab-pane fade" id="workflow">
          <pre><code class="language-bash">GET /api/v1.0/datatable-consignments?sale_id=123&amp;workflow_filter=5</code></pre>
        </div>
      </div>

      <h5 class="mt-4">Response Example</h5>
      <pre><code class="language-json">{
  "data": [
    {
      "id": "789",
      "consignment_id": "CON-2025-001",
      "label": "Estate Jewelry Collection",
      "published": true,
      "promoted": false,
      "status": {
        "value": "active",
        "label": "Active"
      },
      "owner": {
        "id": "456",
        "label": "John Smith",
        "self": "https://backoffice.ddev.site/api/v1.0/datatable-clients/456"
      },
      "customer_number": "CUST-456",
      "sale": {
        "id": "123",
        "label": "Spring Auction 2025"
      },
      "estimated": 500000,
      "insurance_value": 750000,
      "insurance_type": "full",
      "underbid": 0.8,
      "house_consignment": false,
      "no_post_sale": false,
      "consignor_commission_step_type": "percentage",
      "consignor_commission_steps": [
        {
          "step_from": 0,
          "consignor_commission": "15%"
        },
        {
          "step_from": 10000,
          "consignor_commission": "12%"
        }
      ],
      "shipping_methods": [
        {
          "shipping_id": 1,
          "amount": 125.50,
          "tax_customs_number": 789,
          "tax_customs_type": "export",
          "date": "2025-09-15",
          "type": "incoming",
          "method_type": {
            "id": 2,
            "label": "UPS Ground"
          },
          "customs_tracking_number": "1Z999AA10123456784",
          "shipping_notes": "Fragile - Handle with care",
          "description": "Incoming shipment from consignor"
        }
      ],
      "additional_charges": [
        {
          "amount": 50.00,
          "term": {
            "id": 5,
            "label": "Photography"
          },
          "description": "Professional catalog photography",
          "attached_to": "consignment",
          "tax": 10.00
        }
      ],
      "finder_fees": [
        {
          "commission": "5%",
          "finder": {
            "id": "111",
            "label": "Jane Appraiser"
          },
          "item": {
            "id": "222",
            "label": "Lot 45"
          }
        }
      ],
      "tax_type": "standard",
      "tax_customs_number": 789,
      "current_custom_shipping_id": 1,
      "payment_instructions": "Wire transfer to account ending in 1234",
      "files": [
        {
          "id": "999",
          "filename": "consignment_agreement.pdf",
          "url": "https://backoffice.ddev.site/api/v1.0/files/999"
        }
      ],
      "responsible_user": [
        {
          "id": "10",
          "label": "Sarah Johnson"
        }
      ],
      "workflow": {
        "tasks": [
          {
            "id": 1,
            "name": "Intake",
            "completed": true
          },
          {
            "id": 2,
            "name": "Photography",
            "completed": false
          }
        ]
      },
      "statements": [],
      "closed_statements": [],
      "updated": "2025-10-20T15:45:00Z"
    }
  ],
  "count": 87
}</code></pre>

      <h5 class="mt-4">Autocomplete Search</h5>
      <p>Search consignments by consignment ID and label:</p>
      <pre><code class="language-bash">GET /api/v1.0/datatable-consignments?autocomplete[string]=CON-2025</code></pre>

      <h5 class="mt-4">Notes</h5>
      <ul>
        <li>All monetary values are in cents (divide by 100 for dollar amounts)</li>
        <li>Commission percentages are returned as strings with % symbol</li>
        <li>Dates are in ISO 8601 format (YYYY-MM-DD)</li>
        <li>The <code>owner</code> field references the <code>datatable-clients</code> endpoint</li>
        <li>Use <code>sale_id</code> parameter to filter consignments within a specific sale</li>
        <li>The <code>workflow_filter</code> excludes consignments where a specific workflow task is completed</li>
        <li>Autocomplete searches filter by consignment ID (e.g., "CON-2025")</li>
        <li>House consignments are system-managed inventory items</li>
        <li>Shipping methods track both incoming and outgoing shipments with customs information</li>
        <li>Additional charges can be attached to consignments or individual items</li>
        <li>Finder fees track commissions paid to third-party finders</li>
      </ul>

      <h5 class="mt-4">Common Use Cases</h5>
      <ul>
        <li><strong>Get all consignments for a sale:</strong> <code>?sale_id=123</code></li>
        <li><strong>Find consignments by owner:</strong> <code>?filter[owner]=456</code></li>
        <li><strong>Search by owner name:</strong> <code>?filter[owner_name]=Smith</code></li>
        <li><strong>Filter by status:</strong> <code>?filter[status]=active</code></li>
        <li><strong>Find by responsible user:</strong> <code>?filter[responsible_user]=John</code></li>
        <li><strong>Get house consignments only:</strong> <code>?filter[house_consignment]=1</code></li>
        <li><strong>Exclude completed workflow tasks:</strong> <code>?workflow_filter=5</code></li>
        <li><strong>Consignors with email addresses:</strong> <code>?filter[has_email]=1</code></li>
      </ul>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">Related Endpoints</h5>
    </div>
    <div class="card-body">
      <ul>
        <li><a href="../clients/list.html">List Clients</a> - Owner/consignor information</li>
        <li><a href="../clients/get.html">Get Client</a> - Detailed client data</li>
        <li><a href="../sales/list.html">List Sales</a> - Sale information</li>
        <li><a href="../items/list.html">List Items</a> - Items within consignments</li>
        <li><a href="../transactions/list.html">List Transactions</a> - Payment transactions</li>
      </ul>
    </div>
  </div>

  <a href="../index.html" class="btn btn-outline-secondary">Back to API Home</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
<script>
  document.querySelectorAll('pre code').forEach(block => {
    const button = document.createElement('button');
    button.className = 'btn btn-sm btn-outline-secondary copy-btn';
    button.textContent = 'Copy';
    button.onclick = () => {
      navigator.clipboard.writeText(block.textContent);
      button.textContent = 'Copied!';
      setTimeout(() => button.textContent = 'Copy', 2000);
    };
    block.parentElement.appendChild(button);
  });
</script>
</body>
</html>